<?xml-stylesheet href="/rss.xsl" type="text/xsl"?><rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom"><channel><title>潘文斌的技术文章</title><link>https://www.panwenbin.cn/</link><description>Recent content on 潘文斌的技术文章</description><generator>Hugo -- gohugo.io</generator><language>zh-cn</language><copyright>2025 潘文斌</copyright><lastBuildDate>Mon, 23 Jun 2025 08:00:00 +0800</lastBuildDate><atom:link href="https://www.panwenbin.cn/index.xml" rel="self" type="application/rss+xml"/><item><title>Linux上使用Wacom打草稿</title><link>https://www.panwenbin.cn/posts/linux-wacom-usage/</link><pubDate>Tue, 22 Apr 2025 22:00:00 +0800</pubDate><guid>https://www.panwenbin.cn/posts/linux-wacom-usage/</guid><description>潘文斌的技术文章 https://www.panwenbin.cn/posts/linux-wacom-usage/ -&lt;h2 id="起因">起因&lt;/h2>
&lt;blockquote>
&lt;p>最近想静下来学习一下，做个草稿的时候发现手边没有工具。&lt;br>
虽然用平板配笔是不错的选择，但是平板在我用电脑的时候通常不在手边。想起之前入手后一直吃灰的Wacom BAMBOO ONE数位板，看看能不能用吧。&lt;/p>&lt;/blockquote>
&lt;h2 id="软件选择">软件选择&lt;/h2>
&lt;p>找了一下，看中了&lt;code>Xournal++&lt;/code>，直接在源里安装&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo apt install xournalpp
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>打开后是一个本子的样子。&lt;/p>
&lt;h2 id="屏幕">屏幕&lt;/h2>
&lt;p>但是因为我双屏幕，数位板是在两个屏幕上活动的，实际上软件只在第二个屏幕上运行着。&lt;br>
想着能不能设置到只在一个屏幕内活动。&lt;/p>
&lt;h3 id="使用-xsetwacom-设置映射区域">使用 xsetwacom 设置映射区域&lt;/h3>
&lt;p>先获取设备&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ xsetwacom --list devices
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Wacom Bamboo One S Pen stylus id: &lt;span style="color:#d19a66">19&lt;/span> type: STYLUS
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>Wacom Bamboo One S Pen eraser id: &lt;span style="color:#d19a66">20&lt;/span> type: ERASER
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>再获取屏幕&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>$ xrandr
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>HDMI-2 connected 1920x1200+2560+0 &lt;span style="color:#c7bf54">(&lt;/span>normal left inverted right x axis y axis&lt;span style="color:#c7bf54">)&lt;/span> 518mm x 324mm
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>HDMI-3 connected 2560x1440+0+0 &lt;span style="color:#c7bf54">(&lt;/span>normal left inverted right x axis y axis&lt;span style="color:#c7bf54">)&lt;/span> 597mm x 336mm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>将数位板映射到指定屏幕&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>xsetwacom --set &lt;span style="color:#63c381">&amp;#34;Wacom Bamboo One S Pen stylus&amp;#34;&lt;/span> MapToOutput &lt;span style="color:#63c381">&amp;#34;HDMI-2&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>验证有效！&lt;/p>- https://www.panwenbin.cn/posts/linux-wacom-usage/ - 2025 潘文斌</description></item><item><title>Docker如何设置代理</title><link>https://www.panwenbin.cn/posts/docker-set-proxy/</link><pubDate>Mon, 21 Apr 2025 08:00:00 +0800</pubDate><guid>https://www.panwenbin.cn/posts/docker-set-proxy/</guid><description>潘文斌的技术文章 https://www.panwenbin.cn/posts/docker-set-proxy/ -&lt;h2 id="问题">问题&lt;/h2>
&lt;blockquote>
&lt;p>Docker在国内使用时经常出现网络不稳定的情况，比如拉取镜像时速度很慢，甚至失败。&lt;br>
如何给Docker设置代理呢？&lt;/p>&lt;/blockquote>
&lt;h2 id="回答">回答&lt;/h2>
&lt;h3 id="dockerd-代理">Dockerd 代理&lt;/h3>
&lt;p>给Docker服务设置代理，可以作用于镜像拉取&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo mkdir -p /etc/systemd/system/docker.service.d
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo touch /etc/systemd/system/docker.service.d/proxy.conf
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>内容如下：&lt;/p>
&lt;pre tabindex="0">&lt;code>[Service]
Environment=&amp;#34;HTTP_PROXY=http://proxy.example.com:8080/&amp;#34;
Environment=&amp;#34;HTTPS_PROXY=http://proxy.example.com:8080/&amp;#34;
Environment=&amp;#34;NO_PROXY=localhost,127.0.0.1,.example.com&amp;#34;
&lt;/code>&lt;/pre>&lt;p>重启Docker服务&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl restart docker
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="container-代理">Container 代理&lt;/h3>
&lt;p>给Docker容器设置代理，可以作用于容器内的网络请求&lt;/p>
&lt;p>修改&lt;code>~/.docker/config.json&lt;/code>，按结构添加如下内容：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c7bf54">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#63c381">&amp;#34;proxies&amp;#34;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c7bf54">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#63c381">&amp;#34;default&amp;#34;&lt;/span>:
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c7bf54">{&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#63c381">&amp;#34;httpProxy&amp;#34;&lt;/span>: &lt;span style="color:#63c381">&amp;#34;http://proxy.example.com:8080&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#63c381">&amp;#34;httpsProxy&amp;#34;&lt;/span>: &lt;span style="color:#63c381">&amp;#34;http://proxy.example.com:8080&amp;#34;&lt;/span>,
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#63c381">&amp;#34;noProxy&amp;#34;&lt;/span>: &lt;span style="color:#63c381">&amp;#34;localhost,127.0.0.1,.example.com&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c7bf54">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c7bf54">}&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c7bf54">}&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="docker-build-代理">Docker Build 代理&lt;/h3>
&lt;p>对于在Docker Build阶段，上述容器代理又是不生效的。需要用&lt;code>--build-arg&lt;/code>注入代理设置。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>docker build . &lt;span style="color:#d26464;font-weight:bold">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d26464;font-weight:bold">&lt;/span> --build-arg &lt;span style="color:#63c381">&amp;#34;HTTP_PROXY=http://proxy.example.com:8080/&amp;#34;&lt;/span> &lt;span style="color:#d26464;font-weight:bold">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d26464;font-weight:bold">&lt;/span> --build-arg &lt;span style="color:#63c381">&amp;#34;HTTPS_PROXY=http://proxy.example.com:8080/&amp;#34;&lt;/span> &lt;span style="color:#d26464;font-weight:bold">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d26464;font-weight:bold">&lt;/span> --build-arg &lt;span style="color:#63c381">&amp;#34;NO_PROXY=localhost,127.0.0.1,.example.com&amp;#34;&lt;/span> &lt;span style="color:#d26464;font-weight:bold">\
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#d26464;font-weight:bold">&lt;/span> -t your/image:tag
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h2 id="使用镜像">使用镜像&lt;/h2>
&lt;p>除了设置代理外，如果只是拉取镜像，还可以使用国内的镜像源，比如：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo mkdir -p /etc/docker
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo tee /etc/docker/daemon.json &lt;span style="color:#98c379">&amp;lt;&amp;lt;-&amp;#39;EOF&amp;#39;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">{
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> &amp;#34;registry-mirrors&amp;#34;: [
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> &amp;#34;https://dockerproxy.com&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> &amp;#34;https://docker.mirrors.ustc.edu.cn&amp;#34;,
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> &amp;#34;https://docker.nju.edu.cn&amp;#34;
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379"> ]
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">}
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#98c379">EOF&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl daemon-reload
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo systemctl restart docker
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://www.panwenbin.cn/posts/docker-set-proxy/ - 2025 潘文斌</description></item><item><title>安装win11如何跳过联网账户使用本地账户</title><link>https://www.panwenbin.cn/posts/win11-local-account/</link><pubDate>Mon, 21 Apr 2025 08:00:00 +0800</pubDate><guid>https://www.panwenbin.cn/posts/win11-local-account/</guid><description>潘文斌的技术文章 https://www.panwenbin.cn/posts/win11-local-account/ -&lt;h2 id="问题">问题&lt;/h2>
&lt;blockquote>
&lt;p>在安装windows11的过程中，会要求登录或创建联网帐号，而没有使用本地帐号的选项。&lt;/p>&lt;/blockquote>
&lt;h2 id="回答">回答&lt;/h2>
&lt;p>在要求使用联机帐号的界面，按&lt;code>Shift+F10&lt;/code>打开命令行，执行&lt;/p>
&lt;pre tabindex="0">&lt;code>start ms-cxh:localonly
&lt;/code>&lt;/pre>&lt;p>会出现创建本地帐号的界面，创建完成就会进入下一步了。&lt;/p>
&lt;p>旧的&lt;code>oobe\bypassnro.cmd&lt;/code>，没效果了。&lt;/p>- https://www.panwenbin.cn/posts/win11-local-account/ - 2025 潘文斌</description></item><item><title>Linux如何关闭ipv6</title><link>https://www.panwenbin.cn/posts/linux-disable-ipv6/</link><pubDate>Mon, 21 Apr 2025 00:00:00 +0800</pubDate><guid>https://www.panwenbin.cn/posts/linux-disable-ipv6/</guid><description>潘文斌的技术文章 https://www.panwenbin.cn/posts/linux-disable-ipv6/ -&lt;h2 id="问题">问题&lt;/h2>
&lt;blockquote>
&lt;p>国内IPv6网络环境不太稳定，有时候要选择性的关闭和开启IPv6。&lt;br>
在Linux上如何关闭IPv6呢？&lt;/p>&lt;/blockquote>
&lt;h2 id="回答">回答&lt;/h2>
&lt;h3 id="临时关闭">临时关闭&lt;/h3>
&lt;p>直接操作&lt;code>/proc/sys&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo sh -c &lt;span style="color:#98c379">&amp;#39;echo 1 &amp;gt; /proc/sys/net/ipv6/conf/all/disable_ipv6&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>或者使用&lt;code>sysctl&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo sysctl -w net.ipv6.conf.all.disable_ipv6&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="持久关闭">持久关闭&lt;/h3>
&lt;p>使用&lt;code>/etc/sysctl.conf&lt;/code>配置，添加下面内容&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>net.ipv6.conf.all.disable_ipv6 &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>重启或者执行如下命令生效&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo sysctl -p
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://www.panwenbin.cn/posts/linux-disable-ipv6/ - 2025 潘文斌</description></item><item><title>如何在Linux TTY终端正确显示中文</title><link>https://www.panwenbin.cn/posts/linux-tty-chinese/</link><pubDate>Mon, 21 Apr 2025 00:00:00 +0800</pubDate><guid>https://www.panwenbin.cn/posts/linux-tty-chinese/</guid><description>潘文斌的技术文章 https://www.panwenbin.cn/posts/linux-tty-chinese/ -&lt;h2 id="问题">问题&lt;/h2>
&lt;blockquote>
&lt;p>当Xorg出现问题时，会尝试切换到TTY下执行命令，但是中文是不能正常显示的。&lt;br>
那么在Linux TTY终端中，如何正确显示中文呢？&lt;/p>&lt;/blockquote>
&lt;h2 id="回答">回答&lt;/h2>
&lt;p>使用fbterm。FbTerm是一个使用frame buffer 设备或VESA 显卡的终端模拟器。&lt;/p>
&lt;p>先安装fbterm&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo apt-get install fbterm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>权限设置：需要将当前用户添加到video组，并给fbterm设置suid的权限。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo adduser &lt;span style="color:#c678dd">$(&lt;/span>whoami&lt;span style="color:#c678dd">)&lt;/span> video
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo chmod u+s /usr/bin/fbterm
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>运行&lt;code>fbterm&lt;/code>&lt;/p>
&lt;p>默认字体和大小效果不太好，可以指定字体和大小。比如使用Nerd Font（需要另外安装）：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>fbterm --font-names&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#63c381">&amp;#34;SauceCodePro Nerd Font Mono&amp;#34;&lt;/span> --font-size&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#d19a66">16&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>也可以把参数写入配置文件&lt;code>~/.fbtermrc&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-ini" data-lang="ini">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b3d23c">font-names&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#98c379">&amp;#34;SauceCodePro Nerd Font Mono&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#b3d23c">font-size&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#98c379">16&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://www.panwenbin.cn/posts/linux-tty-chinese/ - 2025 潘文斌</description></item><item><title>KVM安装系统时没有对应的系统选择</title><link>https://www.panwenbin.cn/posts/kvm-no-os/</link><pubDate>Wed, 02 Apr 2025 00:00:00 +0800</pubDate><guid>https://www.panwenbin.cn/posts/kvm-no-os/</guid><description>潘文斌的技术文章 https://www.panwenbin.cn/posts/kvm-no-os/ -&lt;h2 id="问题">问题&lt;/h2>
&lt;blockquote>
&lt;p>使用virt-manager创建虚拟机时，比较新的系统没有对应的选择，比如创建debian12的系统，只有看到最高到debian11。大概数据太旧了，所以来尝试更新一下这个操作系统列表的数据。&lt;/p>&lt;/blockquote>
&lt;h2 id="分析">分析&lt;/h2>
&lt;p>这些系统数据肯定是存储在某个地方的，经过搜索，使用&lt;code>osinfo-query os&lt;/code>可以查看&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo apt-get install libosinfo-bin
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>执行&lt;code>osinfo-query os&lt;/code>后，确实没有debian12。&lt;/p>
&lt;p>还有一个包是&lt;code>osinfo-db&lt;/code>，已经安装过了的。&lt;code>dpkg -L osinfo-db&lt;/code>也可以看到一个个系统对应的文件。众所周知debian的官方源中的包都是比较旧的，估计要下个版本发布才会更新了。&lt;/p>
&lt;h2 id="更新">更新&lt;/h2>
&lt;p>通过官方站点&lt;a href="https://releases.pagure.org/libosinfo/">下载db数据&lt;/a>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo apt-get install osinfo-db-tools
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>wget https://releases.pagure.org/libosinfo/osinfo-db-20250124.tar.xz
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>sudo osinfo-db-import --system osinfo-db-20250124.tar.xz
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>关闭virt-manager重新打开，再创建虚拟机时就可以看到debian12了。&lt;/p>- https://www.panwenbin.cn/posts/kvm-no-os/ - 2025 潘文斌</description></item><item><title>带有LaTeX的markdown转pdf</title><link>https://www.panwenbin.cn/posts/latex-markdown-to-pdf/</link><pubDate>Mon, 24 Mar 2025 08:00:00 +0800</pubDate><guid>https://www.panwenbin.cn/posts/latex-markdown-to-pdf/</guid><description>潘文斌的技术文章 https://www.panwenbin.cn/posts/latex-markdown-to-pdf/ -&lt;h2 id="事出有因">事出有因&lt;/h2>
&lt;blockquote>
&lt;p>用Obsidian写了些数学笔记，要打印出来，看到Obsidian只有导出pdf的选项，那也还算方便打印吧。结果导出的pdf在公式那边出错了，然后就有了这个markdown转pdf的探索过程。&lt;/p>&lt;/blockquote>
&lt;h2 id="其他方案">其他方案&lt;/h2>
&lt;h3 id="vscode插件">VSCode插件&lt;/h3>
&lt;p>尝试了安装量最多的&lt;code>Markdown PDF&lt;/code>插件，从提示看依赖chromium。转pdf是成功了，但是公式不支持渲染，应该是这个包还算比较轻量吧。&lt;/p>
&lt;p>顺便记录一下它给我Debian上安装的Chrome路径&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>~/.vscode/extensions/yzane.markdown-pdf-1.5.0/node_modules/puppeteer-core/.local-chromium/linux-722234/chrome-linux
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="pandoc">pandoc&lt;/h3>
&lt;p>在Debian上尝试了pandoc，为了支持LaTex而安装了texlive-full，结果这个包比预想的大好多。&lt;/p>
&lt;p>执行转换命令&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>pandoc test.md -o test.pdf &lt;span style="color:#8a93a5;font-style:italic"># 提示Error&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pandoc test.md -o test.pdf --pdf-engine&lt;span style="color:#c7bf54">=&lt;/span>xelatex &lt;span style="color:#8a93a5;font-style:italic"># 可以生成pdf，但是中文不显示&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pandoc test.md -o test.pdf --pdf-engine&lt;span style="color:#c7bf54">=&lt;/span>xelatex -V &lt;span style="color:#dcaeea">CJKmainfont&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#63c381">&amp;#34;Noto Sans CJK SC&amp;#34;&lt;/span> &lt;span style="color:#8a93a5;font-style:italic"># 中文显示，但是公式中文下标不显示&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>pandoc test.md -o test.pdf --pdf-engine&lt;span style="color:#c7bf54">=&lt;/span>lualatex -V &lt;span style="color:#dcaeea">CJKmainfont&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#63c381">&amp;#34;Noto Sans CJK SC&amp;#34;&lt;/span> &lt;span style="color:#8a93a5;font-style:italic"># 中文和公式下标都正常，速度稍慢&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>另外，转换的pdf，边缘空白较大。总体效果不满意。&lt;/p>
&lt;h2 id="回归">回归&lt;/h2>
&lt;p>在Obsidian上看大纲也不完整，然后细看生成失败的pdf，公式和前面的文字连在一起。&lt;br>
尝试出问题的地方LaTeX前给了一个换行，就都正常了。&lt;br>
最后还是直接用Obsidian就够了。&lt;/p>- https://www.panwenbin.cn/posts/latex-markdown-to-pdf/ - 2025 潘文斌</description></item><item><title>使用mpv播放网页中的视频</title><link>https://www.panwenbin.cn/posts/mpv-play-web-video/</link><pubDate>Sun, 02 Mar 2025 08:00:00 +0800</pubDate><guid>https://www.panwenbin.cn/posts/mpv-play-web-video/</guid><description>潘文斌的技术文章 https://www.panwenbin.cn/posts/mpv-play-web-video/ -&lt;h2 id="契机">契机&lt;/h2>
&lt;blockquote>
&lt;p>Linux下的Chrome播放视频不支持硬件加速。虽然Firefox可以支持，但是平时还是用Chrome多一点。配置视频地址解析是可以让MPV来播放的，正好mpv还内置了调用yt-dlp来处理视频地址解析，youtube和B站都支持，那正好试一下吧。&lt;/p>&lt;/blockquote>
&lt;h2 id="配置">配置&lt;/h2>
&lt;p>mpv开启硬件加速。对于Intel核心显卡，配置文件&lt;code>~/.config/mpv/mpv.conf&lt;/code>中添加如下内容：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic"># 启用硬件解码&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#dcaeea">hwdec&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>vaapi
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic"># 指定视频输出后端（可选尝试不同组合）&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#dcaeea">vo&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>gpu
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic"># 可选：针对某些场景优化&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#dcaeea">profile&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>gpu-hq
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>下载最新版本的yt-dlp，因为旧版可能已经无效。我目前下载的版本是&lt;code>2025.02.19&lt;/code>，放到了&lt;code>/usr/local/bin/&lt;/code>下。&lt;/p>
&lt;p>设置yt-dlp的配置文件&lt;code>~/.yt-dlp/config&lt;/code>，其实是支持多个配置地址的，我选了这个地址。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>--proxy 127.0.0.1:8118
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>--cookies-from-browser chrome
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>给mpv设置yt-dlp的相关内容，加在配置文件&lt;code>~/.config/mpv/mpv.conf&lt;/code>中&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic"># 设置yt-dlp的文件位置&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>script-opts&lt;span style="color:#c7bf54">=&lt;/span>ytdl_hook-ytdl_path&lt;span style="color:#c7bf54">=&lt;/span>/usr/local/bin/yt-dlp
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic"># 设置格式，我这边是Intel UHD Graphics 630，所以选择优先mp4和webm，最大1080p，编码vp9,hevc,h264,h265这些，因为av1不支持啊&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ytdl-format&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#63c381">&amp;#34;(mp4,webm)bestvideo[height&amp;lt;=1080][vcodec~=&amp;#39;^(vp9|(he|a)vc|h26[45])&amp;#39;]+bestaudio/best&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic"># 这边重复设置一遍代理&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>ytdl-raw-options-append&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#dcaeea">proxy&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>http://127.0.0.1:8118
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>播放网址的时候，把&lt;code>https://&lt;/code>协议改成&lt;code>ytdl://&lt;/code>，强制使用yt-dlp来解析视频地址。&lt;/p>
&lt;p>如果要在浏览器呼起mpv，只要给xdg-open注册&lt;code>ytdl://&lt;/code>协议，新建&lt;code>~/.local/share/applications/ytdl.desktop&lt;/code>，内容如下：&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c7bf54">[&lt;/span>Desktop Entry&lt;span style="color:#c7bf54">]&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#dcaeea">Name&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>Ytdl Handler
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#dcaeea">Exec&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>/usr/bin/mpv %u
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#dcaeea">Type&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>Application
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#dcaeea">MimeType&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>x-scheme-handler/ytdl;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>然后执行&lt;code>update-desktop-database ~/.local/share/applications/&lt;/code>更新数据库。&lt;/p>
&lt;p>最后只要让浏览器打开&lt;code>ytdl://&lt;/code>的链接就可以了。最简单收藏夹放一个js代码来替换。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c1abea">javascript&lt;/span>&lt;span style="color:#c7bf54">:&lt;/span>(&lt;span style="color:#c678dd">function&lt;/span>() {&lt;span style="color:#ef8383">window&lt;/span>.&lt;span style="color:#c1abea">location&lt;/span>.&lt;span style="color:#c1abea">href&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#ef8383">window&lt;/span>.&lt;span style="color:#c1abea">location&lt;/span>.&lt;span style="color:#c1abea">href&lt;/span>.&lt;span style="color:#c1abea">replace&lt;/span>(&lt;span style="color:#56b6c2">/^https?/&lt;/span>,&lt;span style="color:#63c381">&amp;#34;ytdl&amp;#34;&lt;/span>);})();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>要体验更好可以写油猴脚本甚至浏览器插件。&lt;br>
搞了一个右键超链接菜单的油猴脚本，如下&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-javascript" data-lang="javascript">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">// ==UserScript==
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">// @name 自定义右键菜单（油猴版）
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">// @namespace http://tampermonkey.net/
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">// @version 1.0
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">// @description 右键点击超链接时，显示自定义菜单（复制、打开、新标签页等）
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">// @author ChatGPT
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">// @match *://www.youtube.com/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">// @match *://www.bilibili.com/*
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">// @grant GM_setClipboard
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">// @run-at document-end
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">// ==/UserScript==
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>(&lt;span style="color:#c678dd">function&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#98c379">&amp;#39;use strict&amp;#39;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">let&lt;/span> &lt;span style="color:#c1abea">customMenu&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#b756ff;font-weight:bold">null&lt;/span>; &lt;span style="color:#8a93a5;font-style:italic">// 存储菜单元素
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ef8383">document&lt;/span>.&lt;span style="color:#c1abea">addEventListener&lt;/span>(&lt;span style="color:#63c381">&amp;#34;contextmenu&amp;#34;&lt;/span>, &lt;span style="color:#c678dd">function&lt;/span>(&lt;span style="color:#c1abea">event&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">let&lt;/span> &lt;span style="color:#c1abea">target&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#c1abea">event&lt;/span>.&lt;span style="color:#c1abea">target&lt;/span>.&lt;span style="color:#c1abea">closest&lt;/span>(&lt;span style="color:#63c381">&amp;#34;a&amp;#34;&lt;/span>); &lt;span style="color:#8a93a5;font-style:italic">// 只对超链接生效
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span> &lt;span style="color:#c678dd">if&lt;/span> (&lt;span style="color:#c7bf54">!&lt;/span>&lt;span style="color:#c1abea">target&lt;/span>) &lt;span style="color:#c678dd">return&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">event&lt;/span>.&lt;span style="color:#c1abea">preventDefault&lt;/span>(); &lt;span style="color:#8a93a5;font-style:italic">// 阻止默认右键菜单
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span> &lt;span style="color:#c1abea">createCustomMenu&lt;/span>(&lt;span style="color:#c1abea">target&lt;/span>.&lt;span style="color:#c1abea">href&lt;/span>, &lt;span style="color:#c1abea">event&lt;/span>.&lt;span style="color:#c1abea">pageX&lt;/span>, &lt;span style="color:#c1abea">event&lt;/span>.&lt;span style="color:#c1abea">pageY&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">function&lt;/span> &lt;span style="color:#c1abea">createCustomMenu&lt;/span>(&lt;span style="color:#c1abea">link&lt;/span>, &lt;span style="color:#c1abea">x&lt;/span>, &lt;span style="color:#c1abea">y&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">removeCustomMenu&lt;/span>(); &lt;span style="color:#8a93a5;font-style:italic">// 先删除旧的菜单
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8a93a5;font-style:italic">// 创建菜单容器
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span> &lt;span style="color:#c1abea">customMenu&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#ef8383">document&lt;/span>.&lt;span style="color:#c1abea">createElement&lt;/span>(&lt;span style="color:#63c381">&amp;#34;div&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">customMenu&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">position&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;absolute&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">customMenu&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">top&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#c1abea">y&lt;/span> &lt;span style="color:#c7bf54">+&lt;/span> &lt;span style="color:#63c381">&amp;#34;px&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">customMenu&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">left&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#c1abea">x&lt;/span> &lt;span style="color:#c7bf54">+&lt;/span> &lt;span style="color:#63c381">&amp;#34;px&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">customMenu&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">background&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;white&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">customMenu&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">border&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;1px solid #ccc&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">customMenu&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">boxShadow&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;2px 2px 5px rgba(0,0,0,0.2)&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">customMenu&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">padding&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;5px 0&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">customMenu&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">borderRadius&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;5px&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">customMenu&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">fontSize&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;14px&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">customMenu&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">zIndex&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;10000&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">customMenu&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">cursor&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;pointer&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8a93a5;font-style:italic">// 菜单项数据
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span> &lt;span style="color:#c678dd">let&lt;/span> &lt;span style="color:#c1abea">items&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> [
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> { &lt;span style="color:#c1abea">text&lt;/span>&lt;span style="color:#c7bf54">:&lt;/span> &lt;span style="color:#63c381">&amp;#34;▶️ 使用MPV播放&amp;#34;&lt;/span>, &lt;span style="color:#c1abea">action&lt;/span>&lt;span style="color:#c7bf54">:&lt;/span> () =&amp;gt; { &lt;span style="color:#ef8383">window&lt;/span>.&lt;span style="color:#c1abea">location&lt;/span>.&lt;span style="color:#c1abea">href&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#c1abea">link&lt;/span>.&lt;span style="color:#c1abea">replace&lt;/span>(&lt;span style="color:#56b6c2">/^https?/&lt;/span>,&lt;span style="color:#63c381">&amp;#34;ytdl&amp;#34;&lt;/span>); } },
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> ];
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8a93a5;font-style:italic">// 创建菜单项
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span> &lt;span style="color:#c1abea">items&lt;/span>.&lt;span style="color:#c1abea">forEach&lt;/span>(&lt;span style="color:#c1abea">item&lt;/span> =&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">let&lt;/span> &lt;span style="color:#c1abea">menuItem&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#ef8383">document&lt;/span>.&lt;span style="color:#c1abea">createElement&lt;/span>(&lt;span style="color:#63c381">&amp;#34;div&amp;#34;&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">menuItem&lt;/span>.&lt;span style="color:#c1abea">textContent&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#c1abea">item&lt;/span>.&lt;span style="color:#c1abea">text&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">menuItem&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">padding&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;8px 15px&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">menuItem&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">whiteSpace&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;nowrap&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">menuItem&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">color&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;#333&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">menuItem&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">background&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;white&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8a93a5;font-style:italic">// 悬停效果
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span> &lt;span style="color:#c1abea">menuItem&lt;/span>.&lt;span style="color:#c1abea">onmouseover&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> () =&amp;gt; &lt;span style="color:#c1abea">menuItem&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">background&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;#f0f0f0&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">menuItem&lt;/span>.&lt;span style="color:#c1abea">onmouseout&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> () =&amp;gt; &lt;span style="color:#c1abea">menuItem&lt;/span>.&lt;span style="color:#c1abea">style&lt;/span>.&lt;span style="color:#c1abea">background&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;white&amp;#34;&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8a93a5;font-style:italic">// 绑定点击事件
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span> &lt;span style="color:#c1abea">menuItem&lt;/span>.&lt;span style="color:#c1abea">onclick&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> () =&amp;gt; {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">item&lt;/span>.&lt;span style="color:#c1abea">action&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">removeCustomMenu&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> };
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">customMenu&lt;/span>.&lt;span style="color:#c1abea">appendChild&lt;/span>(&lt;span style="color:#c1abea">menuItem&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> });
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ef8383">document&lt;/span>.&lt;span style="color:#c1abea">body&lt;/span>.&lt;span style="color:#c1abea">appendChild&lt;/span>(&lt;span style="color:#c1abea">customMenu&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8a93a5;font-style:italic">// 点击其他地方隐藏菜单
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span> &lt;span style="color:#ef8383">document&lt;/span>.&lt;span style="color:#c1abea">addEventListener&lt;/span>(&lt;span style="color:#63c381">&amp;#34;click&amp;#34;&lt;/span>, &lt;span style="color:#c1abea">removeCustomMenu&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">function&lt;/span> &lt;span style="color:#c1abea">removeCustomMenu&lt;/span>() {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c678dd">if&lt;/span> (&lt;span style="color:#c1abea">customMenu&lt;/span>) {
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">customMenu&lt;/span>.&lt;span style="color:#c1abea">remove&lt;/span>();
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#c1abea">customMenu&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#b756ff;font-weight:bold">null&lt;/span>;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ef8383">document&lt;/span>.&lt;span style="color:#c1abea">removeEventListener&lt;/span>(&lt;span style="color:#63c381">&amp;#34;click&amp;#34;&lt;/span>, &lt;span style="color:#c1abea">removeCustomMenu&lt;/span>);
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> }
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>})();
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>- https://www.panwenbin.cn/posts/mpv-play-web-video/ - 2025 潘文斌</description></item><item><title>macOS根据连接的WiFi自动切换代理</title><link>https://www.panwenbin.cn/posts/mac-autoswitch-proxy/</link><pubDate>Sun, 23 Feb 2025 08:00:00 +0800</pubDate><guid>https://www.panwenbin.cn/posts/mac-autoswitch-proxy/</guid><description>潘文斌的技术文章 https://www.panwenbin.cn/posts/mac-autoswitch-proxy/ -&lt;h2 id="问题描述">问题描述&lt;/h2>
&lt;blockquote>
&lt;p>macOS下的代理不像iOS那样设置在每个WiFi连接中的，而是不同WiFi使用同一个设置。
这在多个网络环境下需要不同的代理设置时就很不方便了。&lt;/p>&lt;/blockquote>
&lt;h2 id="搜索">搜索&lt;/h2>
&lt;h3 id="修改代理配置">修改代理配置&lt;/h3>
&lt;p>可以使用&lt;code>networksetup&lt;/code>，找到两种方式：&lt;/p>
&lt;ul>
&lt;li>使用networksetup命令，直接设置代理和开关代理；&lt;/li>
&lt;li>使用networksetup命令，修改网络位置，每个网络位置可以设置不同的代理和其他一些内容，从而达到修改代理配置的目的。&lt;/li>
&lt;/ul>
&lt;h3 id="自动触发">自动触发&lt;/h3>
&lt;p>不依赖第三方软件可以使用&lt;code>launchd&lt;/code>。&lt;/p>
&lt;h2 id="networksetup">networksetup&lt;/h2>
&lt;h3 id="设置代理">设置代理&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>networksetup -setwebproxy &lt;span style="color:#63c381">&amp;#34;Wi-Fi&amp;#34;&lt;/span> 192.168.2.2 &lt;span style="color:#d19a66">8118&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>networksetup -setsecurewebproxy &lt;span style="color:#63c381">&amp;#34;Wi-Fi&amp;#34;&lt;/span> 192.168.2.2 &lt;span style="color:#d19a66">8118&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>networksetup -setwebproxystate &lt;span style="color:#63c381">&amp;#34;Wi-Fi&amp;#34;&lt;/span> on
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>networksetup -setsecurewebproxystate &lt;span style="color:#63c381">&amp;#34;Wi-Fi&amp;#34;&lt;/span> on
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="关闭代理">关闭代理&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>networksetup -setwebproxystate &lt;span style="color:#63c381">&amp;#34;Wi-Fi&amp;#34;&lt;/span> off
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>networksetup -setsecurewebproxystate &lt;span style="color:#63c381">&amp;#34;Wi-Fi&amp;#34;&lt;/span> off
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="切换网络位置">切换网络位置&lt;/h3>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>networksetup -switchtolocation &lt;span style="color:#63c381">&amp;#34;Automatic&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>如果新建了叫做&lt;code>Home&lt;/code>的网络位置，可以使用&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>networksetup -switchtolocation &lt;span style="color:#63c381">&amp;#34;Home&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>切换到&lt;code>Home&lt;/code>网络位置。&lt;/p>
&lt;h2 id="获取wifi网络ssid">获取WiFi网络SSID&lt;/h2>
&lt;h3 id="ipconfig">ipconfig&lt;/h3>
&lt;p>对于Sequoia(15)，好几个获取SSID的方式都失效了，最后找到通过ipconfig可以。&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>ipconfig getsummary &lt;span style="color:#c678dd">$(&lt;/span>networksetup -listallhardwareports | awk &lt;span style="color:#98c379">&amp;#39;/Hardware Port: Wi-Fi/{getline; print $2}&amp;#39;&lt;/span>&lt;span style="color:#c678dd">)&lt;/span> | awk -F &lt;span style="color:#98c379">&amp;#39; SSID : &amp;#39;&lt;/span> &lt;span style="color:#98c379">&amp;#39;/ SSID : / {print $2}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="airport">airport&lt;/h3>
&lt;p>对于Monterey(12)到Sonoma(14.3.1)，可以使用&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>/System/Library/PrisvateFrameworks/Apple80211.framework/Resources/airport -I | awk -F&lt;span style="color:#98c379">&amp;#39;: &amp;#39;&lt;/span> &lt;span style="color:#98c379">&amp;#39;/ SSID: / {print $2}&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;h3 id="wdutil">wdutil&lt;/h3>
&lt;p>对于Sonoma(14.4)，可以使用&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>sudo /usr/bin/wdutil info | /usr/bin/awk &lt;span style="color:#98c379">&amp;#39;/SSID/ { print $NF }&amp;#39;&lt;/span> | head -n &lt;span style="color:#d19a66">1&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>缺点是需要&lt;code>sudo&lt;/code>&lt;/p>
&lt;h3 id="networksetup-1">networksetup&lt;/h3>
&lt;p>对于Monterey(12)到Sonoma(14.4)的版本，可以使用&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>networksetup -getairportnetwork en0 | /usr/bin/awk -F &lt;span style="color:#63c381">&amp;#34;: &amp;#34;&lt;/span> &lt;span style="color:#98c379">&amp;#39;{ print $2 }&amp;#39;&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>优点是兼容版本最广泛&lt;/p>
&lt;h2 id="shell脚本">shell脚本&lt;/h2>
&lt;p>直接切换代理的完整脚本&lt;code>/usr/local/bin/proxy_switch.sh&lt;/code>&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">#!/bin/sh
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span>&lt;span style="color:#dcaeea">SSID&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#c678dd">$(&lt;/span>/System/Library/PrivateFrameworks/Apple80211.framework/Resources/airport -I | awk -F&lt;span style="color:#98c379">&amp;#39;: &amp;#39;&lt;/span> &lt;span style="color:#98c379">&amp;#39;/ SSID: / {print $2}&amp;#39;&lt;/span>&lt;span style="color:#c678dd">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic"># Wi-Fi 名称替换为实际值，例如 &amp;#34;MY-WIFI-HOME&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">if&lt;/span> &lt;span style="color:#c7bf54">[&lt;/span> &lt;span style="color:#63c381">&amp;#34;&lt;/span>&lt;span style="color:#dcaeea">$SSID&lt;/span>&lt;span style="color:#63c381">&amp;#34;&lt;/span> &lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;MY-WIFI-HOME&amp;#34;&lt;/span> &lt;span style="color:#c7bf54">]&lt;/span>; &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8a93a5;font-style:italic"># 启用代理（替换代理地址和端口）&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> networksetup -setwebproxy &lt;span style="color:#63c381">&amp;#34;Wi-Fi&amp;#34;&lt;/span> 192.168.2.2 &lt;span style="color:#d19a66">8118&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> networksetup -setsecurewebproxy &lt;span style="color:#63c381">&amp;#34;Wi-Fi&amp;#34;&lt;/span> 192.168.2.2 &lt;span style="color:#d19a66">8118&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> networksetup -setwebproxystate &lt;span style="color:#63c381">&amp;#34;Wi-Fi&amp;#34;&lt;/span> on
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> networksetup -setsecurewebproxystate &lt;span style="color:#63c381">&amp;#34;Wi-Fi&amp;#34;&lt;/span> on
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#8a93a5;font-style:italic"># 关闭代理&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> networksetup -setwebproxystate &lt;span style="color:#63c381">&amp;#34;Wi-Fi&amp;#34;&lt;/span> off
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> networksetup -setsecurewebproxystate &lt;span style="color:#63c381">&amp;#34;Wi-Fi&amp;#34;&lt;/span> off
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>记得给文件设置可执行属性，&lt;code>chmod +x /usr/local/bin/proxy_switch.sh&lt;/code>。&lt;/p>
&lt;p>假如创建了Home和Work两个网络位置，完整的脚本&lt;code>/usr/local/bin/wifi-trigger-location.sh&lt;/code>如下&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">#!/bin/bash
&lt;/span>&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic">&lt;/span>&lt;span style="color:#8a93a5;font-style:italic">#sleep 0.2 # 这边可以考虑加上延迟，防止获取不到SSID&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#dcaeea">current_ssid&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#98c379">`&lt;/span>ipconfig getsummary &lt;span style="color:#c678dd">$(&lt;/span>networksetup -listallhardwareports | awk &lt;span style="color:#98c379">&amp;#39;/Hardware Port: Wi-Fi/{getline; print $2}&amp;#39;&lt;/span>&lt;span style="color:#c678dd">)&lt;/span> | awk -F &lt;span style="color:#98c379">&amp;#39; SSID : &amp;#39;&lt;/span> &lt;span style="color:#98c379">&amp;#39;/ SSID : / {print $2}&amp;#39;&lt;/span>&lt;span style="color:#98c379">`&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#dcaeea">current_location&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#c678dd">$(&lt;/span>networksetup -getcurrentlocation&lt;span style="color:#c678dd">)&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#8a93a5;font-style:italic"># 根据 Wi-Fi 名称切换网络位置&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">if&lt;/span> &lt;span style="color:#c7bf54">[[&lt;/span> &lt;span style="color:#63c381">&amp;#34;&lt;/span>&lt;span style="color:#dcaeea">$current_ssid&lt;/span>&lt;span style="color:#63c381">&amp;#34;&lt;/span> &lt;span style="color:#c7bf54">==&lt;/span> &lt;span style="color:#63c381">&amp;#34;MY-WIFI-HOME&amp;#34;&lt;/span> &lt;span style="color:#c7bf54">]]&lt;/span>; &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dcaeea">new_location&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#63c381">&amp;#34;Home&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">elif&lt;/span> &lt;span style="color:#c7bf54">[[&lt;/span> &lt;span style="color:#63c381">&amp;#34;&lt;/span>&lt;span style="color:#dcaeea">$current_ssid&lt;/span>&lt;span style="color:#63c381">&amp;#34;&lt;/span> &lt;span style="color:#c7bf54">==&lt;/span> &lt;span style="color:#63c381">&amp;#34;MY-WIFI-WORK&amp;#34;&lt;/span> &lt;span style="color:#c7bf54">]]&lt;/span>; &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dcaeea">new_location&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#63c381">&amp;#34;Work&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#dcaeea">new_location&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#63c381">&amp;#34;Automatic&amp;#34;&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">fi&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">if&lt;/span> &lt;span style="color:#c7bf54">[[&lt;/span> &lt;span style="color:#63c381">&amp;#34;&lt;/span>&lt;span style="color:#dcaeea">$current_location&lt;/span>&lt;span style="color:#63c381">&amp;#34;&lt;/span> !&lt;span style="color:#c7bf54">=&lt;/span> &lt;span style="color:#63c381">&amp;#34;&lt;/span>&lt;span style="color:#dcaeea">$new_location&lt;/span>&lt;span style="color:#63c381">&amp;#34;&lt;/span> &lt;span style="color:#c7bf54">]]&lt;/span>; &lt;span style="color:#c678dd">then&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> networksetup -switchtolocation &lt;span style="color:#63c381">&amp;#34;&lt;/span>&lt;span style="color:#dcaeea">$new_location&lt;/span>&lt;span style="color:#63c381">&amp;#34;&lt;/span> &amp;gt;&amp;gt; ~/wifitrigger.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ef8383">echo&lt;/span> &lt;span style="color:#63c381">&amp;#34;switching to &lt;/span>&lt;span style="color:#dcaeea">$new_location&lt;/span>&lt;span style="color:#63c381">&amp;#34;&lt;/span> &amp;gt;&amp;gt; ~/wifitrigger.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">else&lt;/span>
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &lt;span style="color:#ef8383">echo&lt;/span> &lt;span style="color:#63c381">&amp;#34;already &lt;/span>&lt;span style="color:#dcaeea">$new_location&lt;/span>&lt;span style="color:#63c381">&amp;#34;&lt;/span> &amp;gt;&amp;gt; ~/wifitrigger.log
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&lt;span style="color:#c678dd">fi&lt;/span>
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>记得给文件设置可执行属性，&lt;code>chmod +x /usr/local/bin/wifi-trigger-location.sh&lt;/code>。&lt;/p>
&lt;h2 id="连接wifi时触发">连接WiFi时触发&lt;/h2>
&lt;h3 id="launchd">launchd&lt;/h3>
&lt;p>macOS的launched类似于Linux的systemd，可以用来定时或条件触发执行命令。
编写一个&lt;code>~/Library/LaunchAgents/com.user.wifitrigger.plist&lt;/code>文件&lt;/p>
&lt;div class="highlight">&lt;pre tabindex="0" style="color:#b0c4de;background-color:#282c34;-moz-tab-size:4;-o-tab-size:4;tab-size:4;">&lt;code class="language-bash" data-lang="bash">&lt;span style="display:flex;">&lt;span>&amp;lt;?xml &lt;span style="color:#dcaeea">version&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#63c381">&amp;#34;1.0&amp;#34;&lt;/span> &lt;span style="color:#dcaeea">encoding&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#63c381">&amp;#34;UTF-8&amp;#34;&lt;/span>?&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;!DOCTYPE plist PUBLIC &lt;span style="color:#63c381">&amp;#34;-//Apple//DTD PLIST 1.0//EN&amp;#34;&lt;/span> &lt;span style="color:#63c381">&amp;#34;http://www.apple.com/DTDs/PropertyList-1.0.dtd&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;plist &lt;span style="color:#dcaeea">version&lt;/span>&lt;span style="color:#c7bf54">=&lt;/span>&lt;span style="color:#63c381">&amp;#34;1.0&amp;#34;&lt;/span>&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;dict&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;key&amp;gt;Label&amp;lt;/key&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;string&amp;gt;com.user.wifitrigger&amp;lt;/string&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;key&amp;gt;ProgramArguments&amp;lt;/key&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;array&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;string&amp;gt;/usr/local/bin/wifi-trigger-location.sh&amp;lt;/string&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;/array&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;key&amp;gt;WatchPaths&amp;lt;/key&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;array&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;!-- 监听网络配置变化 --&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;string&amp;gt;/Library/Preferences/SystemConfiguration/com.apple.wifi.message-tracer.plist&amp;lt;/string&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;/array&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;key&amp;gt;RunAtLoad&amp;lt;/key&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span> &amp;lt;true/&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;/dict&amp;gt;
&lt;/span>&lt;/span>&lt;span style="display:flex;">&lt;span>&amp;lt;/plist&amp;gt;
&lt;/span>&lt;/span>&lt;/code>&lt;/pre>&lt;/div>&lt;p>通过&lt;code>launchctl load -w ~/Library/LaunchAgents/com.user.wifitrigger.plist&lt;/code>加载配置文件。
通过&lt;code>launchctl unload ~/Library/LaunchAgents/com.user.wifitrigger.plist&lt;/code>卸载配置文件。&lt;/p>
&lt;p>此时WiFi连接时就会触发&lt;code>/usr/local/bin/wifi-trigger-location.sh&lt;/code>脚本。&lt;/p>- https://www.panwenbin.cn/posts/mac-autoswitch-proxy/ - 2025 潘文斌</description></item><item><title>旧Mac安装新MacOS系统</title><link>https://www.panwenbin.cn/posts/old-mac-new-macos/</link><pubDate>Sun, 16 Feb 2025 08:00:00 +0800</pubDate><guid>https://www.panwenbin.cn/posts/old-mac-new-macos/</guid><description>潘文斌的技术文章 https://www.panwenbin.cn/posts/old-mac-new-macos/ -&lt;h2 id="现状">现状&lt;/h2>
&lt;blockquote>
&lt;p>有一台2012年中的MacBook Air (13-inch, Mid 2012)，标识为&lt;code>MacBookAir5,2&lt;/code>，型号为A1466，内存4G，硬盘128G，官方支持的最新系统为macOS Catalina（10.15），但是从macOS Monterey（12）开始逐渐增加了随航等互联互通的功能，很多软件也需要系统版本12或13才能安装了，非常希望能升到较新的系统。&lt;/p>&lt;/blockquote>
&lt;h2 id="方案">方案&lt;/h2>
&lt;blockquote>
&lt;p>通过检索，使用OpenCore Legacy Patcher工具可以安装官方不支持macOS系统。并且A1466的Intel Graphics HD 4000显卡刚好开始支持Metal，有显卡加速，流畅度较好。唯一限制较大的是只有4G内存。
系统则选择了Monterey（12），因为从Ventura（13）开始显卡加速变了，虽然OCLP v0.5.0开始有支持，但还是有一些问题的，详见&lt;a href="https://github.com/dortania/OpenCore-Legacy-Patcher/issues/1008">Legacy Metal&lt;/a>。&lt;/p>&lt;/blockquote>
&lt;h2 id="步骤">步骤&lt;/h2>
&lt;p>准备工作：一个U盘(不低于16G，如果15系统则需要大于16G)&lt;/p>
&lt;ol>
&lt;li>下载OpenCore Legacy Patcher工具，&lt;a href="https://dortania.github.io/OpenCore-Legacy-Patcher/">官方网站&lt;/a> 到Release页面下载OpenCore-Patcher-GUI.app.zip&lt;/li>
&lt;li>打开OpenCore-Patcher-GUI.app，点击&lt;code>Create macOS Installer&lt;/code>，然后选择&lt;code>Download macOS Installer&lt;/code>，接着选择版本，我这边选择&lt;code>Monterey 12&lt;/code>，下载完系统镜像会提示是否制作安装盘，此时把U盘插入，选择&lt;code>Flash Installer&lt;/code>，根据容量选择对应的U盘，会自动格式化并写入系统镜像。写完后会提示制作引导，如果错过了，也可以从软件主界面选择&lt;code>Build and Install OpenCore&lt;/code>，然后选择U盘，来制作引导。&lt;/li>
&lt;li>完成后会提示重启，此时按住&lt;code>Option&lt;/code>键，选择EFI boot，按&lt;code>Control+回车&lt;/code>选择，进入后再选择&lt;code>Install macOS&lt;/code>，之后就安装系统，安装过程中会重启几次，没问题的话最后会到登录界面或者初始化界面。&lt;/li>
&lt;li>进入新系统，此时引导还在U盘上，打开OpenCore-Patcher-GUI，选择&lt;code>Build and Install OpenCore&lt;/code>，此时选择系统硬盘，安装引导到硬盘上，然后重启，此时就可以直接从硬盘启动了。&lt;/li>
&lt;/ol>
&lt;h2 id="总结">总结&lt;/h2>
&lt;p>Monterey系统让我可以用Mac的键盘和触控板直接控制iPad2020，让两个老设备无缝配合，相当于有两个屏幕，iPad上可以运行网页或者iOS的App，Mac上可以运行工作软件。并且手不需要离开Macbook就可以操作。&lt;/p>
&lt;h2 id="其他">其他&lt;/h2>
&lt;p>虽然Sequoia的iPhone镜像功能也很好用，但是需要Apple Silicon（M系）处理器或者带T2芯片才能使用。并且我尝试安装Sequoia最后并没有成功，卡在了一个升级画面就过不去了。&lt;/p>- https://www.panwenbin.cn/posts/old-mac-new-macos/ - 2025 潘文斌</description></item></channel></rss>